<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Automotive Aftermarket – Interactive Visualizations</title>
  <style>
    :root { --bg:#f6f8fb; --card:#ffffff; --ink:#1f2937; --muted:#6b7280; --brand:#0ea5e9; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--ink); }
    header { padding: 28px 16px 10px; text-align:center; }
    header h1 { margin: 0 0 8px; font-size: clamp(1.6rem, 2vw + 1rem, 2.2rem); }
    header p.lead { max-width: 900px; margin: 0 auto; color: var(--muted); line-height: 1.5; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px; }
    .card { background: var(--card); border-radius: 16px; padding: 18px 18px 8px; margin: 18px 0; box-shadow: 0 8px 24px rgba(2,6,23,.06); }
    h2 { margin: 0 0 6px; font-size: 1.25rem; }
    p.note { color: var(--muted); margin-top: 4px; }
    .filter { margin: 8px 0 12px; display:flex; align-items:center; gap:8px; }
    select { padding: 8px 10px; border-radius: 10px; border: 1px solid #e5e7eb; background:#fff; }
    .tag { display:inline-block; padding:2px 8px; border-radius:999px; background:#e0f2fe; color:#0369a1; font-size:.85rem; }
    footer { text-align:center; padding: 22px; color: var(--muted); }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
  <header>
    <h1>Automotive Aftermarket – Interactive Visualizations</h1>
    <p class="lead">The automotive aftermarket industry covers the manufacturing, distribution, and retail of parts and services for vehicles after the original sale. It includes component makers, logistics and distributors, e‑commerce platforms, and service workshops. Below you can explore 2023 revenue by headquarters country, how many companies are active in key activity types by country (based on HQ), and the global footprint of companies by number of operating countries.</p>
    <p class="note">Data source: processed from the provided Excel file. Last update: 2025-11-09.</p>
  </header>

  <div class="wrap">

    <section class="card">
      <h2>1) 2023 Revenue by Company (EUR) – filter by <span class="tag">HQ country</span></h2>
      <p class="note">CSV: <code>data/finance_2023_by_hq_eur.csv</code>. Only companies with financial data in <strong>2023</strong> are included. All currencies were converted to EUR using fixed demo rates. Tooltip shows company, HQ ISO code and EUR revenue.</p>
      <div class="filter">
        <label for="hqSelect"><strong>HQ country:</strong></label>
        <select id="hqSelect"></select>
      </div>
      <div id="viz1"></div>
    </section>

    <section class="card">
      <h2>2) Companies by Activity – filter by <span class="tag">HQ country</span></h2>
      <p class="note">CSV: <code>data/activity_counts_by_hq.csv</code>. Counts how many companies (by HQ) operate in each activity: E‑Commerce, Part Distributors, Part Manufacturers, Workshops.</p>
      <div class="filter">
        <label for="hqSelect2"><strong>HQ country:</strong></label>
        <select id="hqSelect2"></select>
      </div>
      <div id="viz2"></div>
    </section>

    <section class="card">
      <h2>3) Global Presence – number of operating countries per company</h2>
      <p class="note">CSV: <code>data/presence_counts.csv</code>. Shows how many countries each company is present in (based on operating presence).</p>
      <div id="viz3"></div>
    </section>

  </div>

  <footer>© 2025 – Vega‑Lite on GitHub Pages</footer>

<script>
// Populate HQ select options from viz1 CSV
fetch("data/finance_2023_by_hq_eur.csv").then(r=>r.text()).then(txt => {
  const rows = txt.trim().split(/\r?\n/).slice(1);
  const hqs = Array.from(new Set(rows.map(l => l.split(",")[1]).filter(Boolean))).sort();
  for (const id of ["hqSelect","hqSelect2"]) {
    const sel = document.getElementById(id);
    hqs.forEach(c => { const o=document.createElement("option"); o.value=c; o.textContent=c; sel.appendChild(o); });
    if (hqs.length) sel.value = hqs[0];
  }
  render();
});

function render() {
  const hq1 = document.getElementById("hqSelect").value;
  const hq2 = document.getElementById("hqSelect2").value || hq1;
  if (document.getElementById("hqSelect2").value === "") document.getElementById("hqSelect2").value = hq1;

  // 1) Revenue by HQ
  const spec1 = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "params":[{"name":"pHQ","value":hq1}],
    "data":{"url":"data/finance_2023_by_hq_eur.csv"},
    "transform":[
      {"calculate":"toNumber(datum.eur_revenue)","as":"eur_revenue"},
      {"filter":{"field":"hq_country","equal":{"expr":"pHQ"} }}
    ],
    "mark":"bar",
    "encoding":{
      "y":{"field":"company","type":"nominal","sort":"-x","title":"Company"},
      "x":{"field":"eur_revenue","type":"quantitative","title":"Revenue (EUR, 2023)"},
      "tooltip":[
        {"field":"company","type":"nominal"},
        {"field":"hq_country","type":"nominal","title":"HQ"},
        {"field":"eur_revenue","type":"quantitative","title":"Revenue (EUR)","format":",.2f"}
      ]
    }
  };

  // 2) Activity counts by HQ
  const spec2 = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "params":[{"name":"pHQ2","value":hq2}],
    "data":{"url":"data/activity_counts_by_hq.csv"},
    "transform":[
      {"filter":{"field":"hq_country","equal":{"expr":"pHQ2"} }},
      {"filter":{"field":"activity_name","oneOf":["E-Commerce","Part Distributors","Part Manufacturers","Workshops"]}}
    ],
    "mark":"bar",
    "encoding":{
      "x":{"field":"activity_name","type":"nominal","title":"Activity"},
      "y":{"field":"companies","type":"quantitative","title":"Companies"},
      "tooltip":[
        {"field":"activity_name","type":"nominal"},
        {"field":"companies","type":"quantitative"}
      ]
    }
  };

  // 3) Presence counts per company
  const spec3 = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "data":{"url":"data/presence_counts.csv"},
    "mark":"bar",
    "encoding":{
      "y":{"field":"company","type":"nominal","sort":"-x","title":"Company"},
      "x":{"field":"countries","type":"quantitative","title":"Operating countries"},
      "tooltip":[
        {"field":"company","type":"nominal"},
        {"field":"countries","type":"quantitative","title":"Countries"}
      ]
    }
  };

  vegaEmbed("#viz1", spec1);
  vegaEmbed("#viz2", spec2);
  vegaEmbed("#viz3", spec3);
}

document.getElementById("hqSelect").addEventListener("change", render);
document.getElementById("hqSelect2").addEventListener("change", render);
</script>
</body>
</html>
